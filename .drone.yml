workspace:
  base: /go
  path: src/github.com/prologic/msgbus

pipeline:
  build:
    image: golang:latest
    commands:
      - make build

  docker:
    image: plugins/docker
    repo: r.mills.io/prologic/msgbus
    registry: r.mills.io
    secrets: [ docker_username, docker_password ]

  notify:
    image: drillster/drone-email
    host: mail.mills.io
    from: drone@mills.io
    skip_verify: true 
    when:
      status: [ changed, failure ]

secrets:
  registry_username:
    external: true
  registry_password:
    external: true
